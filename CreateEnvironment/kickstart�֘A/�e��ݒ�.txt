

#TFTPサーバ設定(入れ物だけ作成。ブートローダは起動後にメディアからコピー)
cd /var/lib/tftpboot/;mkdir pxeboot_cent65
touch /var/lib/tftpboot/pxeboot_cent65/boot.msg
mkdir /var/lib/tftpboot/pxeboot_cent65/pxelinux.cfg

#defaultファイル作成
touch /var/lib/tftpboot/pxeboot_cent65/pxelinux.cfg/default
echo "default CentOS 6.5 core">>/var/lib/tftpboot/pxeboot_cent65/pxelinux.cfg/default
echo "prompt 1">>/var/lib/tftpboot/pxeboot_cent65/pxelinux.cfg/default
echo "timeout 10">>/var/lib/tftpboot/pxeboot_cent65/pxelinux.cfg/default
echo "label CentOS 6.5 core">>/var/lib/tftpboot/pxeboot_cent65/pxelinux.cfg/default
echo "kernel vmlinuz">>/var/lib/tftpboot/pxeboot_cent65/pxelinux.cfg/default
echo "append ksdevice=eth0 ks=http://192.168.0.151/ks/192.168.0.152-kickstart initrd=initrd.img text">>/var/lib/tftpboot/pxeboot_cent65/pxelinux.cfg/default
echo "ipappend 2">>/var/lib/tftpboot/pxeboot_cent65/pxelinux.cfg/default



#DHCPサーバ設定(今回は未登録のMACアドレスにはIPアドレスを払い出さない設定)
echo "subnet 192.168.0.0 netmask 255.255.255.0" >>/etc/dhcp/dhcpd.conf
echo "{" >>/etc/dhcp/dhcpd.conf
echo "  default-lease-time     28800;" >>/etc/dhcp/dhcpd.conf
echo "  max-lease-time         43200;" >>/etc/dhcp/dhcpd.conf
echo "  option routers         192.168.0.1;" >>/etc/dhcp/dhcpd.conf
echo "  option subnet-mask     255.255.255.0;" >>/etc/dhcp/dhcpd.conf
echo "  #range                 192.168.0.151 192.168.0.153;" >>/etc/dhcp/dhcpd.conf
echo "}" >>/etc/dhcp/dhcpd.conf

#DHCPClient個別設定(PuppetServer用)
echo "host puppet" >>/etc/dhcp/dhcpd.conf
echo "{" >>/etc/dhcp/dhcpd.conf
echo "  hardware ethernet      08:00:27:BF:4A:67;" >>/etc/dhcp/dhcpd.conf
echo "  fixed-address          192.168.0.152;" >>/etc/dhcp/dhcpd.conf
echo "  filename               \"pxeboot_cent65/pxelinux.0\";" >>/etc/dhcp/dhcpd.conf
echo "  next-server            192.168.0.151;" >>/etc/dhcp/dhcpd.conf
echo "}" >>/etc/dhcp/dhcpd.conf

#DHCPClient個別設定(PuppetClient用)
echo "host puppec" >>/etc/dhcp/dhcpd.conf
echo "{" >>/etc/dhcp/dhcpd.conf
echo "  hardware ethernet      08:00:27:7F:14:72;" >>/etc/dhcp/dhcpd.conf
echo "  fixed-address          192.168.0.153;" >>/etc/dhcp/dhcpd.conf
echo "  filename               \"pxeboot_cent65/pxelinux.0\";" >>/etc/dhcp/dhcpd.conf
echo "  next-server            192.168.0.151;" >>/etc/dhcp/dhcpd.conf
echo "}" >>/etc/dhcp/dhcpd.conf
